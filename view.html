<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Client Image Gallery</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    img {
      pointer-events: none;
      user-select: none;
    }
    body {
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
  </style>
</head>
<body class="bg-cyan-100 text-gray-800">

  <!-- Navbar -->
  <nav class="bg-gradient-to-r from-teal-700 to-cyan-900 text-white px-4 py-4">
    <div class="max-w-6xl mx-auto flex justify-between items-center">
      <h1 class="text-2xl font-bold">ðŸ“¸ à¦†à§Ÿà¦¨à¦¾ à¦˜à¦° Gallery</h1>
      <div class="flex gap-2 items-center">
        <button onclick="logout()" class="bg-red-500 text-white font-semibold px-4 py-2 rounded hover:bg-red-600">Logout</button>
      </div>
    </div>
  </nav>

  <!-- Filters -->
  <div class="max-w-6xl mx-auto px-4 py-4">
    <div class="flex flex-col md:flex-row gap-4 mb-4">
      <select id="clientFilter" onchange="renderImages()" class="p-2 border rounded w-full md:w-1/2">
        <option value="">Filter by Client</option>
      </select>
      <select id="folderFilter" onchange="renderImages()" class="p-2 border rounded w-full md:w-1/2">
        <option value="">Filter by Category</option>
      </select>
    </div>

    <div id="gallery" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
  </div>

  <!-- Modal -->
  <div id="modal" class="fixed inset-0 bg-black bg-opacity-80 hidden items-center justify-center z-50">
    <img id="modalImg" src="" class="max-h-[90vh] max-w-[90vw]" />
  </div>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white text-center py-4">
    &copy; 2025 à¦†à§Ÿà¦¨à¦¾ à¦˜à¦° Studio. All rights reserved.
  </footer>

  <script>
    const API_BASE = 'https://script.google.com/macros/s/AKfycbyL3SsYryaSYyQRbtx7VmdJhveYEt5ZLRfZdkqsnpfSTJT_b3LoZYm5qcRbIZIjR6j5/exec';
    const loggedInClient = localStorage.getItem('clientName');

    if (!loggedInClient) {
      window.location.href = 'login.html';
    }

    let allImages = [];
    let selectedIndexes = JSON.parse(localStorage.getItem('selectedIndexes') || '[]');

    async function fetchImages() {
      const res = await fetch(API_BASE);
      const data = await res.json();
      allImages = data.filter(img => img.client === loggedInClient);
      populateFilters(allImages);
      renderImages();
    }

    function populateFilters(images) {
      const clients = [...new Set(images.map(i => i.client))].sort();
      const folders = [...new Set(images.map(i => i.filter))].sort();

      document.getElementById('clientFilter').innerHTML = '<option value="">Filter by Client</option>';
      document.getElementById('folderFilter').innerHTML = '<option value="">Filter by Category</option>';

      clients.forEach(c => document.getElementById('clientFilter').innerHTML += `<option value="${c}">${c}</option>`);
      folders.forEach(f => document.getElementById('folderFilter').innerHTML += `<option value="${f}">${f}</option>`);
    }

    function renderImages() {
      const client = document.getElementById('clientFilter').value;
      const folder = document.getElementById('folderFilter').value;
      const gallery = document.getElementById('gallery');
      gallery.innerHTML = '';

      const filtered = allImages.filter(img =>
        (!client || img.client === client) &&
        (!folder || img.filter === folder)
      );

      filtered.forEach(img => {
        const globalIndex = allImages.indexOf(img);
        const isChecked = selectedIndexes.includes(globalIndex);

        const card = document.createElement('div');
        card.className = 'bg-white p-2 shadow rounded flex flex-col items-center';

        const image = document.createElement('img');
        image.src = img.embedLink;
        image.alt = img.name;
        image.className = 'w-full h-32 object-cover rounded cursor-pointer';
        image.onclick = () => showModal(img.embedLink);

        const label = document.createElement('p');
        label.className = 'text-sm mt-2 break-words text-center';
        label.innerText = img.name;

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.className = 'mt-1';
        checkbox.dataset.index = globalIndex;
        checkbox.checked = isChecked;

        checkbox.onchange = () => {
          const idx = parseInt(checkbox.dataset.index);
          if (checkbox.checked) {
            if (!selectedIndexes.includes(idx)) selectedIndexes.push(idx);
          } else {
            selectedIndexes = selectedIndexes.filter(i => i !== idx);
          }
          localStorage.setItem('selectedIndexes', JSON.stringify(selectedIndexes));
        };

        card.appendChild(image);
        card.appendChild(label);
        card.appendChild(checkbox);
        gallery.appendChild(card);
      });
    }

    function showModal(src) {
      const modal = document.getElementById("modal");
      const modalImg = document.getElementById("modalImg");
      modalImg.src = src;
      modal.classList.remove("hidden");
      modal.classList.add("flex");
    }

    window.onclick = function(e) {
      if (e.target.id === 'modal') {
        document.getElementById("modal").classList.add("hidden");
        document.getElementById("modal").classList.remove("flex");
      }
    };

    function logout() {
      localStorage.clear();
      window.location.href = 'login.html';
    }

    function goHome() {
      window.location.href = 'login.html';
    }

    fetchImages();
  </script>
</body>
</html>
